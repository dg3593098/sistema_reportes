{% extends "base.html" %}
{% block title %}Ver Reportes{% endblock %}
{% block content %}
<h2>Reportes del Código</h2>

<form method="POST" action="/ver_reportes">
  <input type="hidden" name="csrf_token" value="{{ request.cookies.get('csrf_token') }}">

  <label for="codigo">Código de acceso:</label>
  <input type="text" id="codigo" name="codigo" required>
  <button type="submit">Buscar</button>
</form>

{% if error %}
<p class="error">{{ error }}</p>
{% endif %}

{% if reportes %}
<h3>Reportes encontrados</h3>
<ul>
  {% for reporte in reportes %}
  <li class="card">
    <strong>Fecha:</strong> {{ reporte.fecha_envio.strftime("%Y-%m-%d %H:%M") }}<br>
    <p>{{ reporte.descripcion }}</p>

<form method="POST" action="/modificar_reporte/{{ reporte.id }}">
  <input type="hidden" name="csrf_token" value="{{ request.cookies.get('csrf_token') }}">

    <textarea name="descripcion" required>{{ reporte.descripcion }}</textarea>
    <button type="submit">Guardar cambios</button>
</form>

    <form method="POST" action="/eliminar_reporte/{{ reporte.id }}">
      <input type="hidden" name="csrf_token" value="{{ request.cookies.get('csrf_token') }}">
      
      <button type="submit" style="background:#b00020;">Eliminar</button>
    </form>
  </li>
  {% endfor %}
</ul>
{% endif %}
{% endblock %}